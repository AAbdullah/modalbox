<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<title>ModalBox Unit Test</title>
	
	<script type="text/javascript" src="../../lib/prototype.js"></script>
	<script type="text/javascript" src="../../lib/scriptaculous.js"></script>
	<script type="text/javascript" src="../../lib/unittest.js"></script>
	
	<script type="text/javascript" src="../../modalbox.js"></script>
	<link rel="stylesheet" href="../../modalbox.css" type="text/css" />
	
	<link rel="stylesheet" href="../test.css" type="text/css" />
	
	<style type="text/css" media="screen">
	</style>
	
</head>

<body>
	<h1>ModalBox Unit Test</h1>
	
	<!-- Log output -->
	<div id="testlog"> </div>
	
	<!-- Tests follow -->
	<script type="text/javascript" language="javascript" charset="utf-8">
	// <![CDATA[

	  new Test.Unit.Runner({
		setup: function(){ with(this) {
			Modalbox.show("Title", "test", { 
				width: 150, 
				height: 150, 
				loadingString: "Тестируем Unicode", 
				closeString: "Закрыть окно", 
				overlayClose: false, 
				overlayDuration: 1, 
				slideDownDuration: 1, 
				slideUpDuration: 1, 
				resizeDuration: 1, 
				method: "POST", 
				params: {section: 'blog', id: '45'},
				afterLoad: function(){ return "test1" }, 
				afterHide: function(){ return "test2" }, 
				afterResize: function(){ return "test3" }, 
				beforeLoad: function(){ return true }, 
				onShow: function(){ return "test5" },
				onUpdate: function(){ return "test6" }
			});
	    }},
		testMBBasics: function() { with(this) {
			wait(2000, function() { with(this) {
				assertInstanceOf(Object, Modalbox);
			}});
	    }},
		testMBParameters: function() { with(this) {
			assertEqual(150, Modalbox.options.width);
			assertEqual(150, Modalbox.options.height);
			assertEqual("Тестируем Unicode", Modalbox.options.loadingString);
			assertEqual("Закрыть окно", Modalbox.options.closeString);
			assertEqual(false, Modalbox.options.overlayClose);
			assertEqual(1, Modalbox.options.overlayDuration);
			assertEqual(1, Modalbox.options.slideDownDuration);
			assertEqual(1, Modalbox.options.slideUpDuration);
			assertEqual(1, Modalbox.options.resizeDuration);
			assertEqual("POST", Modalbox.options.method);
			assert({section: 'blog', id: '45'}, Modalbox.options.params);
		}},
		testMBCallbacks: function(){ with(this) {
			assertEqual("test1", Modalbox.event("afterLoad"));
			assertEqual("test2", Modalbox.event("afterHide"));
			assertEqual("test3", Modalbox.event("afterResize"));
			assertEqual(true, Modalbox.event("beforeLoad"));
			assertEqual("test5", Modalbox.event("onShow"));
			assertEqual("test6", Modalbox.event("onUpdate"));
			
			// Callbacks should be removed after executuion
			assertNull(Modalbox.options.afterLoad);
			assertNull(Modalbox.options.afterHide);
			assertNull(Modalbox.options.afterResize);
			assertNull(Modalbox.options.beforeLoad);
			assertNull(Modalbox.options.onShow);
			assertNull(Modalbox.options.onUpdate);
		}},
		testMBPosition: function() { with(this) {
			
			wait(1500, function() { with(this) {
				assertEqual("absolute", $("MB_close").getStyle("position"));
				assertEqual(150, $("MB_window").getWidth(), "Width should be 150px");
				assertEqual(150, $("MB_window").getHeight(), "Height should be 150px");
				assertNotEqual(0, $("MB_window").getStyle("left"));
			
				Modalbox.resize(100, 100);
				wait(1500, function() { with(this) {
					assertEqual(250, $("MB_window").getWidth(), "Width should be now 250px");
					assertEqual(250, $("MB_window").getHeight(), "Height should be now 250px");
					
					Modalbox.resize(-100, -100);
					wait(1500, function() { with(this) {
						assertEqual(150, $("MB_window").getWidth(), "Width should be now 150px");
						assertEqual(150, $("MB_window").getHeight(), "Height should be now 150px");
					}});
				}});
			}});
	    }}
		
	  }, "testlog");
	// ]]>
	</script>
</body>
</html>
